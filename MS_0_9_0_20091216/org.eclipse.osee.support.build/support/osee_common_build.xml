<?xml version="1.0" encoding="UTF-8"?>
<project name="Osee Common Build Tasks" default="PdeBuild" basedir=".">
	<!-- this ant file is assumed to be located at <workspace>\org.eclipse.osee.support.build\support, basedir will be the same -->

	<target name="PdeBuild">
		<tstamp />
		<property name="releaseVersion" value="0.9.0" />
		<!-- if behind a firewall then uncomment the following properties:
			<property name="proxy_host" value="www-my-proxy.domain.com" />
			<property name="proxy_port" value="12345" />
		-->
		<property name="topLevelElementType" value="feature" />
		<property name="builder" value="${basedir}" />
		<dirname property="baseLocation" file="${eclipse.launcher}" />
		<dirname property="workspaceLocationSub" file="${basedir}" />
		<dirname property="workspaceLocation" file="${workspaceLocationSub}" />
		<property name="buildDirectory" value="${workspaceLocation}/sandbox" />
		<property name="pdeTarget" value="main" />

		<antcall target="set-proxy" />

		<delete verbose="true" quiet="true" includeEmptyDirs="true">
			<fileset dir="${buildDirectory}" excludes="plugins/**/*" />
		</delete>

		<copy todir="${buildDirectory}/maps">
			<fileset file="${basedir}/osee.map" />
		</copy>
				
		<antcall target="copyOrbitMapFile" />
		<antcall target="copySupplementalMapFile" />

		<ant antfile="${eclipse.pdebuild.scripts}/build.xml" target="${pdeTarget}" />
		
		<antcall target="internalPostBuild" />

		<antcall target="copyToUpdatesite" />
	</target>

	<target name="set-proxy" if="proxy_host">
		<echo message="Setting proxy to ${proxy_host}:${proxy_port}" />
		<setproxy proxyhost="${proxy_host}" proxyport="${proxy_port}" />
	</target>

	<target name="internalPostBuild" if="postBuildFile">
		<ant antfile="${postBuildFile}" target="${postBuildTarget}" />
	</target>

	<target name="copyToUpdatesite" if="update.site">
		<delete failonerror="false">
			<fileset dir="${update.site}" includes="**/*" defaultexcludes="false" />
		</delete>

		<copy todir="${update.site}">
			<fileset dir="${buildDirectory}/repository" />
		</copy>
	</target>

	<target name="copySupplementalMapFile" if="mapFile">
		<copy todir="${buildDirectory}/maps">
			<fileset file="${mapFile}" />
		</copy>
	</target>
	
	<target name="copyOrbitMapFile" if="downloadOrbitPlugins">
		<copy todir="${buildDirectory}/maps">
			<fileset file="${basedir}/orbit.map" />
		</copy>
	</target>
</project>