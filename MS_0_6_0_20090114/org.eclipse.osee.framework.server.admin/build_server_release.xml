<?xml version="1.0" encoding="UTF-8"?>
<project default="RUN_FIRST_FOR_LBA" name="build">

	<property name="releaseName" value="0.6.0_RC_2008_12_23-14-46_2" />
	
	<target name="plugin_export_lba">
		<pde.exportPlugins destination="osee_server_bundles" exportSource="false" exportType="directory" 
			plugins="lba.db.connection,org.postgresql.driver,oracle.driver,org.eclipse.osee.framework.postgresql,org.eclipse.osee.framework.session.management.servlet,org.eclipse.osee.framework.server.lookup.servlet,org.eclipse.osee.framework.core,org.eclipse.osee.framework.core.server,org.eclipse.osee.framework.oracle,org.eclipse.osee.framework.client.info.servlet,org.eclipse.osee.framework.artifact.servlet,org.eclipse.osee.framework.search.engine,org.eclipse.osee.framework.search.engine.servlet,org.eclipse.osee.framework.branch.management,org.eclipse.osee.framework.branch.management.servlet,org.eclipse.osee.framework.db.connection,org.eclipse.osee.framework.jdk.core,org.eclipse.osee.framework.logging,org.eclipse.osee.framework.resource.locator.attribute,org.eclipse.osee.framework.resource.locator.snapshot,org.eclipse.osee.framework.resource.management,org.eclipse.osee.framework.resource.management.servlet,org.eclipse.osee.framework.resource.provider.attribute,org.eclipse.osee.framework.resource.provider.common,org.eclipse.osee.framework.resource.provider.snapshot,org.eclipse.osee.framework.server.admin" useJARFormat="true"/>
	</target>
	
	<target name="plugin_export_demo">
		<pde.exportPlugins destination="osee_server_bundles" exportSource="false" exportType="directory" 
			plugins="org.eclipse.osee.demo.db.connection,derby.driver,org.eclipse.osee.framework.derby,org.postgresql.driver,org.eclipse.osee.framework.postgresql,org.eclipse.osee.framework.session.management.servlet,org.eclipse.osee.framework.server.lookup.servlet,org.eclipse.osee.framework.core,org.eclipse.osee.framework.core.server,org.eclipse.osee.framework.client.info.servlet,org.eclipse.osee.framework.search.engine,org.eclipse.osee.framework.search.engine.servlet,org.eclipse.osee.framework.artifact.servlet,org.eclipse.osee.framework.branch.management,org.eclipse.osee.framework.branch.management.servlet,org.eclipse.osee.framework.db.connection,org.eclipse.osee.framework.jdk.core,org.eclipse.osee.framework.logging,org.eclipse.osee.framework.resource.locator.attribute,org.eclipse.osee.framework.resource.locator.snapshot,org.eclipse.osee.framework.resource.management,org.eclipse.osee.framework.resource.management.servlet,org.eclipse.osee.framework.resource.provider.attribute,org.eclipse.osee.framework.resource.provider.common,org.eclipse.osee.framework.resource.provider.snapshot,org.eclipse.osee.framework.server.admin" useJARFormat="true"/>
	</target>
	
	<target name="generateconfigIni">
		<java classname="ConfigIniGeneration" failonerror="true" fork="true">
			<arg value="${basedir}/"/>
			<classpath>
				<pathelement location="buildsupport.jar"/>
				<pathelement path="${java.class.path}"/>
			</classpath>
		</java>
	</target>
	
	<target name="clean">
		<delete includeemptydirs="true">
				    <fileset dir="osee_server_bundles/configuration" includes="**/*"/>
				  </delete>
				  <delete includeemptydirs="true">
				    <fileset dir="osee_server_bundles/plugins" includes="**/*"/>
				  </delete>
	</target>
	
	<target name="RUN_FIRST_FOR_LBA">
		<antcall target="clean"/>
		<antcall target="plugin_export_lba"/>
	</target>
	
	<target name="RUN_FIRST_FOR_DEMO">
		<antcall target="clean"/>
		<antcall target="plugin_export_demo"/>
	</target>
	
	<target name="RUN_SECOND">
		<antcall target="generateconfigIni"/>
	</target>
	
	<target name="COPY">
		<copy todir="/lba_ws/osee_common/osee_installs/osee_server/${releaseName}">
			<fileset dir="${basedir}/osee_server_bundles" excludes="**/.svn" />
		</copy>
		<chmod perm="+x" type="file">
			<fileset dir="/lba_ws/osee_common/osee_installs/osee_server/${releaseName}">
				<include name="*.sh"/>
			</fileset>
		</chmod>
	</target>
	
</project>
